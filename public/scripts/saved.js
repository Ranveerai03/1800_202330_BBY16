document.getElementById("add").onclick = function () {
  location.href = "../../app/html/map.html"
}

//----------------------------------------------------------
// This function is the only function that's called.
// This strategy gives us better control of the page.
//----------------------------------------------------------
function doAll() {
  firebase.auth().onAuthStateChanged(user => {
    if (user) {
      getBookmarks(user)
    } else {
      console.log("No user is signed in");
    }
  });
}
doAll();

function getBookmarks(user) {
  db.collection("users").doc(user.uid).get()
    .then(userDoc => {

      // Get the Array of bookmarks
      var bookmarks = userDoc.data().bookmarks;
      console.log(bookmarks);

      // Get pointer the new card template
      let newcardTemplate = document.getElementById("savedCardTemplate");

      // Iterate through the ARRAY of bookmarked hikes (document ID's)
      for (let i = bookmarks.length - 1; i >= 0; i--) {
        const thisLocationID = bookmarks[i];
        console.log(thisLocationID);
        db.collection("searches").doc(thisLocationID).get().then(doc => {
          var docID = doc.id;  //this is the autogenerated ID of the document
          var title = doc.data().name; // get value of the "name" key
          var locationCode = doc.data().code; //get unique ID to each hike to be used for fetching right image
          var city = doc.data().city; //gets the length field
          var ts = doc.data().last_updated.toDate();
          var time = new Date(ts).toLocaleString();
          // time = getTime(thisLocationID);
          console.log(time + "hahahaha");
          console.log(docID);

          //clone the new card
          let newcard = newcardTemplate.content.cloneNode(true);

          //update title and some pertinant information
          newcard.querySelector('.card-title').innerHTML = title;
          newcard.querySelector('.card-city').innerHTML = city;
          newcard.querySelector('.route-timestamp').innerHTML = "Last Updated: " + time;

          newcard.querySelector('a').href = "locationReviews.html?id=" + doc.id + "&locationName=" + title + "&city=" + city + "&province=" + doc.data().province + "";

          hikeCardGroup.appendChild(newcard);

        })
      };
})
}

// function getTime(thisLocationID){
//   db.collection("reviews")
//     .where("thislocationID", "==", thisLocationID)
//     .orderBy("timestamp", "desc")
//     .get()
//     .then((doc) => {
//       var ts = doc.data().timestamp.toDate();
//       var time = new Date(ts).toLocaleString();
//       return time;

//     });
// }

